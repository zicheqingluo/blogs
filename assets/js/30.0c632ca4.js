(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{481:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"go-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-module"}},[s._v("#")]),s._v(" go module")]),s._v(" "),t("h3",{attrs:{id:"go111module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go111module"}},[s._v("#")]),s._v(" GO111MODULE")]),s._v(" "),t("p",[s._v("要启用"),t("code",[s._v("go module")]),s._v("支持首先要设置环境变量"),t("code",[s._v("GO111MODULE")]),s._v("，通过它可以开启或关闭模块支持，它有三个可选值："),t("code",[s._v("off")]),s._v("、"),t("code",[s._v("on")]),s._v("、"),t("code",[s._v("auto")]),s._v("，默认值是"),t("code",[s._v("auto")]),s._v("。")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("GO111MODULE=off")]),s._v("禁用模块支持，编译时会从"),t("code",[s._v("GOPATH")]),s._v("和"),t("code",[s._v("vendor")]),s._v("文件夹中查找包。")]),s._v(" "),t("li",[t("code",[s._v("GO111MODULE=on")]),s._v("启用模块支持，编译时会忽略"),t("code",[s._v("GOPATH")]),s._v("和"),t("code",[s._v("vendor")]),s._v("文件夹，只根据 "),t("code",[s._v("go.mod")]),s._v("下载依赖。")]),s._v(" "),t("li",[t("code",[s._v("GO111MODULE=auto")]),s._v("，当项目在"),t("code",[s._v("$GOPATH/src")]),s._v("外且项目根目录有"),t("code",[s._v("go.mod")]),s._v("文件时，开启模块支持。")])]),s._v(" "),t("p",[s._v("简单来说，设置"),t("code",[s._v("GO111MODULE=on")]),s._v("之后就可以使用"),t("code",[s._v("go module")]),s._v("了，以后就没有必要在GOPATH中创建项目了，并且还能够很好的管理项目依赖的第三方包信息。")]),s._v(" "),t("p",[s._v("使用 go module 管理依赖后会在项目根目录下生成两个文件"),t("code",[s._v("go.mod")]),s._v("和"),t("code",[s._v("go.sum")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"goproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goproxy"}},[s._v("#")]),s._v(" GOPROXY")]),s._v(" "),t("p",[s._v("Go1.11之后设置GOPROXY命令为：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://goproxy.cn\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Go1.13之后"),t("code",[s._v("GOPROXY")]),s._v("默认值为"),t("code",[s._v("https://proxy.golang.org")]),s._v("，在国内是无法访问的，所以十分建议大家设置GOPROXY，这里我推荐使用"),t("a",{attrs:{href:"https://studygolang.com/topics/10014",target:"_blank",rel:"nofollow noopener noreferrer"}},[s._v("goproxy.cn"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"go-mod命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-mod命令"}},[s._v("#")]),s._v(" go mod命令")]),s._v(" "),t("p",[s._v("常用的"),t("code",[s._v("go mod")]),s._v("命令如下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("go mod download    下载依赖的module到本地cache（默认为"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOPATH")]),s._v("/pkg/mod目录）\ngo mod edit        编辑go.mod文件\ngo mod graph       打印模块依赖图\ngo mod init        初始化当前文件夹, 创建go.mod文件\ngo mod tidy        增加缺少的module，删除无用的module\ngo mod vendor      将依赖复制到vendor下\ngo mod verify      校验依赖\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"go-mod"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-mod"}},[s._v("#")]),s._v(" go.mod")]),s._v(" "),t("p",[s._v("go.mod文件记录了项目所有的依赖信息，其结构大致如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("module github.com/Q1mi/studygo/blogger\n\ngo "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.12")]),s._v("\n\nrequire "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tgithub.com/DeanThompson/ginpprof v0.0.0-20190408063150-3be636683586\n\tgithub.com/gin-gonic/gin v1.4.0\n\tgithub.com/go-sql-driver/mysql v1.4.1\n\tgithub.com/jmoiron/sqlx v1.2.0\n\tgithub.com/satori/go.uuid v1.2.0\n\tgoogle.golang.org/appengine v1.6.1 // indirect\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("其中，")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("module")]),s._v("用来定义包名")]),s._v(" "),t("li",[t("code",[s._v("require")]),s._v("用来定义依赖包及版本")]),s._v(" "),t("li",[t("code",[s._v("indirect")]),s._v("表示间接引用")])]),s._v(" "),t("h4",{attrs:{id:"replace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#replace"}},[s._v("#")]),s._v(" replace")]),s._v(" "),t("p",[s._v("在国内访问golang.org/x的各个包都需要翻墙，你可以在go.mod中使用replace替换成github上对应的库。")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("replace "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tgolang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("crypto v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20180820150726")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("614d502a4dac "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("golang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("crypto v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20180820150726")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("614d502a4dac\n\tgolang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20180821023952")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("922f4815f713 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("golang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("net v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20180826012351")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("8a410e7b638d\n\tgolang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("org"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("x"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("text v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" github"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("golang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("text v0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"go-get"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-get"}},[s._v("#")]),s._v(" go get")]),s._v(" "),t("p",[s._v("在项目中执行"),t("code",[s._v("go get")]),s._v("命令可以下载依赖包，并且还可以指定下载的版本。")]),s._v(" "),t("ol",[t("li",[s._v("运行"),t("code",[s._v("go get -u")]),s._v("将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号， y是次要版本号)")]),s._v(" "),t("li",[s._v("运行"),t("code",[s._v("go get -u=patch")]),s._v("将会升级到最新的修订版本")]),s._v(" "),t("li",[s._v("运行"),t("code",[s._v("go get package@version")]),s._v("将会升级到指定的版本号version")])]),s._v(" "),t("p",[s._v("如果下载所有依赖可以使用"),t("code",[s._v("go mod download")]),s._v("命令。")]),s._v(" "),t("h2",{attrs:{id:"pporf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pporf"}},[s._v("#")]),s._v(" pporf")]),s._v(" "),t("p",[s._v("Go语言内置了获取程序的运行数据的工具，包括以下两个标准库：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("runtime/pprof")]),s._v("：采集工具型应用运行数据进行分析")]),s._v(" "),t("li",[t("code",[s._v("net/http/pprof")]),s._v("：采集服务型应用运行时数据进行分析")])]),s._v(" "),t("p",[s._v("pprof开启后，每隔一段时间（10ms）就会收集下当前的堆栈信息，获取各个函数占用的CPU以及内存资源；最后通过对这些采样数据进行分析，形成一个性能分析报告。")]),s._v(" "),t("p",[t("em",[s._v("注意，我们只应该在性能测试的时候才在代码中引入pprof。")])]),s._v(" "),t("h3",{attrs:{id:"工具型应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工具型应用"}},[s._v("#")]),s._v(" 工具型应用")]),s._v(" "),t("p",[s._v("如果你的应用程序是运行一段时间就结束退出类型。那么最好的办法是在应用退出的时候把 profiling 的报告保存到文件中，进行分析。对于这种情况，可以使用"),t("code",[s._v("runtime/pprof")]),s._v("库。 首先在代码中导入"),t("code",[s._v("runtime/pprof")]),s._v("工具：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime/pprof"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"cpu性能分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu性能分析"}},[s._v("#")]),s._v(" "),t("strong",[s._v("CPU性能分析")])]),s._v(" "),t("p",[s._v("开启CPU性能分析：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("StartCPUProfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("停止CPU性能分析：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("StopCPUProfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("应用执行结束后，就会生成一个文件，保存了我们的 CPU profiling 数据。得到采样数据之后，使用"),t("code",[s._v("go tool pprof")]),s._v("工具进行CPU性能分析。")]),s._v(" "),t("h4",{attrs:{id:"内存性能优化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内存性能优化"}},[s._v("#")]),s._v(" "),t("strong",[s._v("内存性能优化")])]),s._v(" "),t("p",[s._v("记录程序的堆栈信息")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WriteHeapProfile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("w io"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Writer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("得到采样数据之后，使用"),t("code",[s._v("go tool pprof")]),s._v("工具进行内存性能分析。")]),s._v(" "),t("p",[t("code",[s._v("go tool pprof")]),s._v("默认是使用"),t("code",[s._v("-inuse_space")]),s._v("进行统计，还可以使用"),t("code",[s._v("-inuse-objects")]),s._v("查看分配对象的数量。")]),s._v(" "),t("h3",{attrs:{id:"服务型应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务型应用"}},[s._v("#")]),s._v(" 服务型应用")]),s._v(" "),t("p",[s._v("如果你的应用程序是一直运行的，比如 web 应用，那么可以使用"),t("code",[s._v("net/http/pprof")]),s._v("库，它能够在提供 HTTP 服务进行分析。")]),s._v(" "),t("p",[s._v("如果使用了默认的"),t("code",[s._v("http.DefaultServeMux")]),s._v("（通常是代码直接使用 http.ListenAndServe(“0.0.0.0:8000”, nil)），只需要在你的web server端代码中按如下方式导入"),t("code",[s._v("net/http/pprof")])]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果你使用自定义的 Mux，则需要手动注册一些路由规则：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("r"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/cmdline"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Cmdline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/profile"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Profile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/symbol"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Symbol"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleFunc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/debug/pprof/trace"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Trace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("如果你使用的是gin框架，那么推荐使用"),t("a",{attrs:{href:"https://github.com/gin-contrib/pprof",target:"_blank",rel:"nofollow noopener noreferrer"}},[s._v("github.com/gin-contrib/pprof"),t("OutboundLink")],1),s._v("，在代码中通过以下命令注册pprof相关路由。")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("127.0.0.1:8080/debug/pprof这个路径下还有几个子页面：")]),s._v(" "),t("ul",[t("li",[s._v("/debug/pprof/profile：访问这个链接会自动进行 CPU profiling，持续 30s，并生成一个文件供下载")]),s._v(" "),t("li",[s._v("/debug/pprof/heap： Memory Profiling 的路径，访问这个链接会得到一个内存 Profiling 结果的文件")]),s._v(" "),t("li",[s._v("/debug/pprof/block：block Profiling 的路径")]),s._v(" "),t("li",[s._v("/debug/pprof/goroutines：运行的 goroutines 列表，以及调用关系")])]),s._v(" "),t("h3",{attrs:{id:"分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[s._v("#")]),s._v(" 分析")]),s._v(" "),t("h4",{attrs:{id:"go-tool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-tool"}},[s._v("#")]),s._v(" "),t("strong",[s._v("go tool")])]),s._v(" "),t("p",[s._v("不管是工具型应用还是服务型应用，我们使用相应的pprof库获取数据之后，下一步的都要对这些数据进行分析，我们可以使用"),t("code",[s._v("go tool pprof")]),s._v("命令行工具。")]),s._v(" "),t("p",[t("code",[s._v("go tool pprof")]),s._v("最简单的使用方式为:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("go tool pprof "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("binary"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中：")]),s._v(" "),t("ul",[t("li",[s._v("binary 是应用的二进制文件，用来解析各种符号；")]),s._v(" "),t("li",[s._v("source 表示 profile 数据的来源，可以是本地的文件，也可以是 http 地址。")])]),s._v(" "),t("h4",{attrs:{id:"go-torch和火焰图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go-torch和火焰图"}},[s._v("#")]),s._v(" "),t("strong",[s._v("go-torch和火焰图")])]),s._v(" "),t("ul",[t("li",[s._v("安装go-torch")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("   go get "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" github.com/uber/go-torch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("go-torch 工具的使用非常简单，没有任何参数的话，它会尝试从"),t("code",[s._v("http://localhost:8080/debug/pprof/profile")]),s._v("获取 profiling 数据。它有三个常用的参数可以调整：")]),s._v(" "),t("p",[s._v("u –url：要访问的 URL，这里只是主机和端口部分")]),s._v(" "),t("p",[s._v("-s –suffix：pprof profile 的路径，默认为 /debug/pprof/profile")]),s._v(" "),t("p",[s._v("–seconds：要执行 profiling 的时间长度，默认为 30s")]),s._v(" "),t("ul",[t("li",[s._v("安装 FlameGraph")])]),s._v(" "),t("ol",[t("li",[s._v("下载安装perl：https://www.perl.org/get.html")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用go-torch")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("go-torch "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1:8080 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);